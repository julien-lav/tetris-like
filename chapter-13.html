<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tetris</title>
        <!-- CSS only -->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body>
        <h1 class="text-center p-2">
            Play Tetris
        </h1>
        <div id="game-content">
            <div class="row line p-0 m-0"><!-- 1 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 2 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 3 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 4 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 4 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 4 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 5 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 7 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 8 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div> 
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
            <div class="row line p-0 m-0"><!-- 6 row -->
                <div class="col-1 offset-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
                <div class="col-1 square"></div>
            </div>
        <!-- /end game content-->
        </div>
    </body>
    <script>

        /* DOM */
        const PIECE = document.getElementsByClassName('line');     
        /* GAME LOGIC */
        let paused = false;
        /* MAIN PIECES */
        let t_piece = 
            [
                      [0, 0],
                [1, -1],[1, 0],[1, 1]
            ]
        let o_piece = 
            [
                [0, 0],[0, 1],
                [1, 0],[1, 1]
            ]
        let i_piece = 
            [
                [0, 0],
                [1, 0],
                [2, 0],
                [3, 0]
            ]      
        let s_piece = 
            [   
                    [0, 0],[0, 1],
                [1, -1],[1, 0]
            ];
        let z_piece = 
            [   
                [0, -1],[0, 0],
                    [1, 0],[1, 1]
            ];
        let ll_piece = 
            [
                [0, 0],
                [1, 0],
                [2, 0],[2, 1]
            ];
        let lr_piece = 
            [
                     [0, 0],
                     [1, 0],
            [2, -1], [2, 0]
            ];
 
        const PIECES = [t_piece, o_piece, i_piece, z_piece, s_piece, ll_piece, lr_piece];
        let pieces_lgth = PIECES.length;
        
        /* TURNED PIECES */ /* HARD CODED */

        var t_piece_2 = [[0,0],[1,0],[1,1],[2,0]];
        var t_piece_3 = [[0,-1],[0,0],[0,1],[1,0]];
        var t_piece_4 = [[0,0],[1,-1],[1,0],[2,0]];

        let i_piece_2 = [[1,-2],[1,-1],[1,0],[1,1]];    
        let i_piece_3 = [[0,0],[1,0],[2,0],[3,0]];    
        let i_piece_4 = [[1,-2],[1,-1],[1,0],[1,1]];  
        
        let s_piece_2 = [[0,0],[1,0],[1,1],[2,1]];
        let s_piece_3 = [[0,0],[0,1],[1,-1],[1,0]];
        let s_piece_4 = [[0,0],[1,0],[1,1],[2,1]];

        let z_piece_2 = [[0,0],[1,0],[0,1],[-1,1]];
        let z_piece_3 = [[0,-1],[0,0],[1,0],[1,1]];
        let z_piece_4 = [[0,0],[1,0],[0,1],[-1,1]];

        let ll_piece_2 = [[0,-1],[0,0],[0,1],[1,-1]];
        let ll_piece_3 = [[0,0],[0,1],[1,1],[2,1]];
        let ll_piece_4 = [[1,0],[1,1],[0,1],[1,-1]];

        let lr_piece_2 = [[0,-1],[1,-1],[1,0],[1,1]];
        let lr_piece_3 = [[0,0],[0,-1],[1,-1],[2,-1]];
        let lr_piece_4 = [[0,-1],[0,0],[0,1],[1,1]];

        var T_TAB = [t_piece, t_piece_2, t_piece_3, t_piece_4];
        var I_TAB = [i_piece, i_piece_2, i_piece_3, i_piece_4];
        var S_TAB = [s_piece, s_piece_2, s_piece_3, s_piece_4];
        var Z_TAB = [z_piece, z_piece_2, z_piece_3, z_piece_4];
        var LL_TAB = [ll_piece, ll_piece_2, ll_piece_3, ll_piece_4];
        var LR_TAB = [lr_piece, lr_piece_2, lr_piece_3, lr_piece_4];

        function currentPieces() {
            return current_pieces = 
                [
                    PIECES[getRandomInt(pieces_lgth)], 
                    PIECES[getRandomInt(pieces_lgth)], 
                    PIECES[getRandomInt(pieces_lgth)]
                ];    
        }
            
        function getRandomInt(max) {
            return Math.floor(Math.random() * Math.floor(max));
        }    
        
        function gameInit (x, y, level) {  
            currentPieces();                                              
            game(x, y, level, paused);             
        }

        function game(intX, intY, level) { 
                        
            let current_piece = current_pieces[0];
            
            displayPiece(intX, intY, current_piece);                                        
            var timer = setInterval(function(){ 
                if (paused) return
                removePiece(intX, intY, current_piece);
                if(fixePiece(intX, intY, current_piece)) {
                    intX++;
                } else {
                    current_piece = [];                     
                    clearInterval(timer);
                    fixePiece(intX, intY, current_piece);
                }
                displayPiece(intX, intY, current_piece);  
                }, level);           

            document.addEventListener("keydown", function(event) {                
                removePiece(intX, intY, current_piece)
                if (event.keyCode == '39') { // right arrow
                    if(allowMovement(intX, intY, current_piece, event.keyCode))
                    {
                        intY++;
                    }           
                    displayPiece(intX, intY, current_piece);  
                }
                else if (event.keyCode == '37') {  // left arrow
                    if(allowMovement(intX, intY, current_piece, event.keyCode)) 
                    {
                        intY--;
                    }
                    displayPiece(intX, intY, current_piece);  
                }
                else if (event.keyCode == '40') {  // down arrow
                    if(fixePiece(intX, intY, current_piece)) {
                        intX++
                    } else {
                        current_piece = []; 
                    }
                    displayPiece(intX, intY, current_piece);  
                }
                else if (event.keyCode == '38') { // top arrow
                    current_piece = pieceRotation(intX, intY, current_piece);
                    displayPiece(intX, intY, current_piece);  
                }            
                else if (event.keyCode == '32') { // space bar
                    if (paused == false) {
                        paused = true; 
                    } else {
                        paused = false;
                    }                 
                }
            });               
        }
        
        function fixePiece(intX, intY, current_piece) {
            for (var i = 0; i < current_piece.length; i++) {                
                if (intX + current_piece[i][0] + 1 > 22 ) { 
                    lockBlocks(intX, intY, current_piece) 
                    piecesHandler()                                                             
                    game(0, 5, 1000)
                    return false;
                } 
                else if (PIECE[intX + 1 + current_piece[i][0]].children[intY + current_piece[i][1]].classList.contains('bg-light')) {
                    lockBlocks(intX, intY, current_piece) 
                    piecesHandler()                                                             
                    game(0, 5, 1000)
                    return false;
                }                
            }
            checkForLines();
            return true;
        }

        function piecesHandler() {        
            current_pieces.shift();                                 
            current_pieces.push(PIECES[getRandomInt(pieces_lgth)]); 
        }
        
        function lockBlocks(intX, intY, current_piece) {
            for (var i = 0; i < current_piece.length; i++ ) {
                PIECE[intX + current_piece[i][0]].children[intY + current_piece[i][1]].classList.add('bg-light');               
            }                        
        }

        function allowMovement(intX, intY, current_piece, keyCode) {
            let boolean = true;
            for (var i = 0; i < current_piece.length; i++ ) {
                if((intY + current_piece[i][1])  < 1 && keyCode == '37') {                    
                    boolean = false;         
                } 
                if ((intY + current_piece[i][1]) > 8 && keyCode == '39') {  
                    boolean = false;
                }                 
                if (PIECE[intX + current_piece[i][0]].children[intY + 1 + current_piece[i][1]]) {
                    if (PIECE[intX + current_piece[i][0]].children[intY + 1 + current_piece[i][1]].classList.contains('bg-light') && keyCode == '39') {
                        boolean = false;
                    }                                       
                } 
                if (PIECE[intX + current_piece[i][0]].children[intY - 1 + current_piece[i][1]]) {
                    if (PIECE[intX + current_piece[i][0]].children[intY - 1 + current_piece[i][1]].classList.contains('bg-light') && keyCode == '37') {
                        boolean = false;
                    }                                       
                }                   
            }
            return boolean
        }
        
        function pieceRotation(intX,intY, current_piece) {
            let TAB = [];
            if (T_TAB.includes(current_piece)) {
                TAB = T_TAB;
            }
            if (I_TAB.includes(current_piece)) {
                TAB = I_TAB;
            }
            if (S_TAB.includes(current_piece)) {
                TAB = S_TAB;
            }
            if (Z_TAB.includes(current_piece)) {
                TAB = Z_TAB;
            }
            if (LL_TAB.includes(current_piece)) {
                TAB = LL_TAB;
            }
            if (LR_TAB.includes(current_piece)) {
                TAB = LR_TAB;
            }

            if (TAB.length !== 0) {
                let index = TAB.indexOf(current_piece);                              
                if (index != 3) {                
                    for (var i = 0; i < TAB[index + 1].length; i++) {     
                        if (PIECE[intX + TAB[index + 1][i][0]]) {
                            if (PIECE[intX + TAB[index + 1][i][0]].children[intY + TAB[index + 1][i][1]]) {             
                                if (PIECE[intX + TAB[index + 1][i][0]].children[intY + TAB[index + 1][i][1]].classList.contains('bg-light')) {
                                    return  current_piece;
                                }
                            } else {
                                return  current_piece;
                            }
                        } else {
                            return current_piece;
                        }
                    }
                    current_piece = TAB[index + 1];
                    index = 0;
                } else {
                    for (var i = 0; i < TAB[0].length; i++) {     
                        if (PIECE[intX + TAB[0][i][0]]) {
                            if (PIECE[intX + TAB[0][i][0]].children[intY + TAB[0][i][1]]) {             
                                if (PIECE[intX + TAB[0][i][0]].children[intY + TAB[0][i][1]].classList.contains('bg-light')) {
                                    return current_piece;
                                }
                            } else {
                                return  current_piece;
                            }
                        } else {
                            return  current_piece;
                        }
                    }
                    current_piece = TAB[0];
                }                                   
            }
            return current_piece;
        }

        function displayPiece(intX, intY, current_piece) {          
            for (var i = 0; i < current_piece.length; i++) { 
                PIECE[intX + current_piece[i][0]].children[intY + current_piece[i][1]].classList.add('bg-dark');               
            }
        }

        function removePiece(intX, intY, current_piece) {
            for (var i = 0;i < current_piece.length; i++) { 
                PIECE[intX + current_piece[i][0]].children[intY + current_piece[i][1]].classList.remove('bg-dark');               
            }
        }

        function checkForLines() {  
            let lines = [];
            let boolean = false;
            for (var i = 0; i < PIECE.length; i++) {
                let j = 0;
                while (PIECE[i].children[j].classList.contains('bg-light')) {
                    if (j == 9) {
                        boolean = true;
                        lines.push(i);
                        break;
                    }
                    j++;
                }
            }
            if (boolean) {
                eraseAllLines(lines);            
            }
        }   
    
        function eraseAllLines(lines) {
            for (var i = 0; i < lines.length; i++) {
                let n = 0;
                while (n < 10) {
                    PIECE[lines[i]].children[n].classList.remove('bg-light');
                    n++;
                }                
            }
            reorganizeBoard(lines);
        }

        function reorganizeBoard(lines) {
            for (var i = 0; i < lines.length; i++) {
            let n = lines[i];
                while (n > 0) {                    
                let m = 0;
                    while (m < 10) {
                        console.log([n,m]);                      
                        if (PIECE[n - 1].children[m].classList.contains('bg-light')) {
                            PIECE[n - 1].children[m].classList.remove('bg-light')                        
                            PIECE[n].children[m].classList.add('bg-light')
                        }
                        m++;
                    }
                    n--;
                }               
            }  
        }

        gameInit(0, 5, 1000);
    </script>
</html>

